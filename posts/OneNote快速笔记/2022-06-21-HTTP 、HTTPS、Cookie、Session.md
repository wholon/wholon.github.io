# HTTP 、HTTPS、Cookie、Session

HTTP是基于TCP的，在TCP建立连接之后，才用HTTP来传送数据。

## HTTP状态码

- 2开头 （请求成功）表示成功处理了请求的状态代码。
- 3开头 （请求被重定向）表示要完成请求，需要进一步操作。通常，这些状态代码用来重定向。
- 4开头 （请求错误）这些状态代码表示请求可能出错，妨碍了服务器的处理。
- 5开头（服务器错误）这些状态代码表示服务器在尝试处理请求时发生内部错误。 这些错误可能是服务器本身的错误，而不是请求出错。

### 301 moved permanently、302 found、303 see other

301/302/303都表示重定向，所以放在一起讲解。

- 301表示永久重定向（301 moved permanently），表示请求的资源分配了新url，以后应使用新url。
- 302表示临时性重定向（302 found），请求的资源临时分配了新url，本次请求暂且使用新url。302与301的区别是，302表示临时性重定向，重定向的url还有可能还会改变。
- 303 表示请求的资源路径发生改变，使用GET方法请求新url。她与302的功能一样，但是明确指出使用GET方法请求新url。
- 新url指的是，第一次请求返回的location。

举例说明

1. 浏览器访问http://write.blog.csdn.net, csdn中“我的博客”

2. 服务器，返回状态码 302（url临时改变）和location

3. 浏览器，请求location指定的地址，完成请求。也就是说，浏览器一共请求了2次！

### 304 not modified

客户端发送附带条件的请求时（if-matched,if-modified-since,if-none-match,if-range,if-unmodified-since任一个）服务器端允许请求访问资源，但因发生请求未满足条件的情况后，直接返回304Modified（服务器端资源未改变，可直接使用客户端未过期的缓存）。304状态码返回时，不包含任何响应的主体部分。304虽然被划分在3xx类别中，但是和重定向没有关系。

举例说明

请求hao123主页，js、css、图片状态码很多是304 

| 200  | （成功）           | 服务器已成功处理了请求。 通常，这表示服务器提供了请求的网页。 |
| ---- | ------------------ | ------------------------------------------------------------ |
| 301  | （永久移动）       | 请求的网页已永久移动到新位置。 服务器返回此响应（对 GET 或 HEAD  请求的响应）时，会自动将请求者转到新位置。 |
| 302  | （临时移动）       | 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。 |
| 404  | （未找到）         | 服务器找不到请求的网页。                                     |
| 415  | （请求错误）       | 后台程序不支持提交的content-type                             |
| 405  | （请求错误）       | 请求的方式（get、post、delete）方法与后台规定的方式不符合    |
| 400  | （请求错误）       | 请求的报文中存在语法错误，比如url含有非法字符。  提交json时，如果json格式有问题，接收端接收json，也会出现400 bad  request |
| 401  |                    | 未授权，比如访问SpringSecurity限制了权限的资源               |
| 500  | （服务器内部错误） | 服务器遇到错误，无法完成请求。                               |

## 一次完整的HTTP请求

1. 域名解析：在系统的hosts文件里查找域名对应的IP地址，没有的话向本地DNS发送一个请求报文，本地服务器必须返回完整结果，称为递归查询。如果本地DNS服务器没有，则启动一次远程查询，请求根域名服务器，每次返回一部分域名，直到找到域名对应的IP地址并返回一个响应报文，这个机制称为迭代查询。

1. 1. 查询报文和响应报文都作为UDP数据包发送，即DNS是基于UDP的。

   2. DNS所有的查询答案，包括所有的部分答案都会被缓存，缓存也是有过期时间的。

      ![未命名图片](https://holon-image.oss-cn-beijing.aliyuncs.com/20220620181804D8SEPa.png)

2. 发起TCP的3次握手建立连接 [三次握手]({% post_url 2022-06-20-网络面试笔记 %}#三次握手)
3. 建立TCP连接后发起HTTP请求
4. 服务器响应HTTP请求，业务逻辑处理，返回HTTP响应给浏览器
5. 浏览器得到html代码，会解析html代码，并请求html代码中的资源（如js、css、图片等，并对页面进行渲染最终呈现给用户

## HTTP请求格式

主要有四部分组成，分别是：请求行、请求头、空行、消息体，每部分内容占一行

![未命名图片](https://holon-image.oss-cn-beijing.aliyuncs.com/20220620182536RjNhBc.png)

- 请求行：由三部分组成，GET/POST请求方法、请求资源URL、HTTP版本号
- 请求头：和缓存相关的头（Cache-Control，If-Modified-Since），客户端身份信息（User-Agent）等等
- 消息体：客户端发给服务端的请求数据，这部分数据并不是每个请求必须的

## HTTP响应格式

包括：状态行、响应头、空行、消息体。每部分内容占一行。

![未命名图片](https://holon-image.oss-cn-beijing.aliyuncs.com/20220620182723zf7UgW.png)

- 状态行：HTTP协议版本号，状态码和状态说明三部分构成
- 响应头：响应头是服务器传递给客户端用于说明服务器的一些信息（Content-Type，charset等），以及将来继续访问该资源时的策略。
- 响应体：返回给客户端的HTML文本内容，或者其他格式的数据，比如：视频流、图片或者音频数据。

## Socket

- Socket只是对TCP/IP协议栈操作的抽象，即Socket是TCP/IP协议的API

- WEB Server都是基于Socket编程，又称之为网络编程，网络协议通过一个叫做Socket的对象抽象出来，Socket可以建立网络连接，读数据，写数据。

## HTTPS

由于 http 请求是明文的，链路上的任意一个路由，都可以任意修改数据，没有任何安全可言。因此 HTTPS 就诞生了。

1. https协议需要到ca申请证书，一般免费证书很少，需要交费。

2. http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

3. http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443.

4. http的连接很简单，是无状态的，https协议是由ssl（安全套接层）+http协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

5. HTTPS比HTTP页面加载慢一些，不如HTTP高效，但更安全。

> - 对称加密： 数据使用 A 密钥加密，变成加密后的数据，加密后的数据使用 A 密钥解密，变成数据。
> - 非对称加密：数据使用 A 密钥加密，变成加密后的数据，然后加密后的数据经过 B     密钥解密，变成明文。然后相反的，数据经过 B 加密以后，也能通过 A 解密。 

## Cookie和Session

### 概述

因为HTTP协议是无状态的协议，因此需要引入一种机制跟踪会话。因此有了Cookie和Session。Cookie通过在客户端记录信息确定用户身份，Session通过在服务器端记录信息确定用户身份。

### Cookie机制

1. Cookie以文本文件的方式存放在客户端，每次客户端向服务器发送请求都会带上这些信息。
2. Cookie的内容主要包括：名字、值、过期时间、路径和域。路径与域一起构成cookie的作用范围。域限定网站，路径限定这个网站下的路径。
3. 若不设置过期时间，则表示这个cookie的生命期为浏览器会话期间，关闭浏览器窗口，cookie就消失。这种生命期为浏览器会话期的cookie被称为会话cookie。
4. 会话cookie一般不会存储在硬盘上而是保存在内存里。若设置了过期时间，浏览器就会把cookie保存到硬盘上
5. Cookie信息都是放在请求头和响应头里
6. Cookie具有不可跨域名性，即一个网站只能取得它放在你的电脑中的信息，它无法从其它的cookie文件中取得信息，也无法得到你的电脑上的其它任何东西。
7. 客户端保存的Cookie中的内容大多数经过了加密处理，因此一般用户看来只是一些毫无意义的字母数字组合，只有服务器的CGI处理程序才知道它们真正的含义。

### Session机制

Session思想：分布式和中心化 Session共享

1. Session是由Tomcat创建的，Cookie应该也是。

1. session机制是一种服务器端的机制，当用户请求来自应用程序的 Web 页时，如果该用户还没有会话，则 Web 服务器将自动创建一个 Session 对象。当会话过期或被放弃后，服务器将终止该会话。
2. Session一般存在内存里，可以设置有效期，只要用户访问，服务器就会更新session的有效期。超期会删除。
3. 当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含了一个session ID。
4. 如果已包含则说明以前已经为此客户端创建过session，服务器就按照session id把这个session检索出来使用（检索不到，会新建一个）；
5. 如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id。
6. session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id 将被在本次响应中通过Cookie机制返回给客户端保存。
7. URL 重写：当客户端不支持Cookie时，可以采用URL重写来解决session id客户端保存的问题。即把服务器返回页面的a标签的URL后面加上sessionid=XXXXXXXX.

### Cookie和Session的区别

1. Cookie保存在客户端，Session保存在服务端。

2. Cookie不是很安全，因为存放在本地。

3. 单个Cookie的数据不能超过4K，很多浏览器都限制一个站点最多保存50个Cookie。